<div class="wrapperTitle" data-bind="visible:loading">
  <i class="fa fa-circle-o-notch fa-spin"></i> Loading...
</div>
<div data-bind="if:!loading()">
  <div class="wrapperTitle">
    <i class="fa fa-heartbeat"></i> Patient Level Prediction
  </div>
  <div class="asset-heading">
    <input type="text" /> <!-- data-bind="textInput: cohortComparison().name, css: { emptyInput: !(cohortComparison().name() && (cohortComparison().name().length > 0)) }" /> -->
    <div class="btn-group" role="group">
      <button class="btn btn-sm btn-success" title="Save" data-bind="click: save, enable:canSave"><i class="fa fa-save"></i></button>
      <button class="btn btn-sm btn-primary" title="Close" data-bind="click: close"><i class="fa fa-times"></i></button>
      <button class="btn btn-sm btn-danger" title="Delete" data-bind="click: $component.delete, enable: canDelete()"><i class="fa fa-trash-o"></i></button>
    </div>
  </div>
  <div id="summary" data-bind="visible: $component.managerMode() == 'summary'">
    <ul class="nav nav-tabs">
      <li role="presentation" data-bind="css: { active: $component.tabMode() == 'specification' }, click: function() { $component.tabMode('specification') };"><a>Specification</a>
      </li>
      <li role="presentation" data-bind="css: { active: $component.tabMode() == 'export' }, click: function() { $component.tabMode('export') };"><a>Utilities</a>
      </li>
    </ul>
    <div id="specificationSummary" class="tab-content">
      <div role="tabpanel" data-bind="css: { active: $component.tabMode() == 'specification'}" class="tab-pane">
        <div class="paddedWrapper">
            <div id="filters">
              <div class="row">
                  <div class="filter-icon"><i class="fa fa-filter fa-2x"></i></div>
                  <div>
                    <ul class="nav nav-pills">
                      <li role="presentation" data-bind="css: {active: $component.specificationPillMode() == 'all' }, click: function() {$component.specificationPillMode('all') };"><a>All</a></li>
                      <li role="presentation" data-bind="css: {active: $component.specificationPillMode() == 'predictions' }, click: function() {$component.specificationPillMode('predictions') };"><a>Prediction Problem Settings</a></li>
                      <li role="presentation" data-bind="css: {active: $component.specificationPillMode() == 'analysisSettings' }, click: function() {$component.specificationPillMode('analysisSettings') };"><a>Analysis Settings</a></li>
                      <li role="presentation" data-bind="css: {active: $component.specificationPillMode() == 'executionSettings' }, click: function() {$component.specificationPillMode('executionSettings') };"><a>Execution Settings</a></li>
                      <li role="presentation" data-bind="css: {active: $component.specificationPillMode() == 'evaluationSettings' }, click: function() {$component.specificationPillMode('evaluationSettings') };"><a>Evaluation Settings</a></li>
                    </ul>        
                  </div>
              </div>
            </div>
            <div role="tabpanel" data-bind="visible: $component.specificationPillMode() == 'all' || $component.specificationPillMode() == 'predictions'" class="tab-pane">
              <div class="paddedWrapper">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                      <i class="fa fa-heartbeat"></i> Prediction Problem Settings
                    </div>
                    <div class="panel-body">
                      <div class="paddedWrapper">
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            <i class="fa fa-users"></i> Target Cohorts
                            <button type="button" class="btn btn-primary btn-sm pull-right" data-bind="click: addTarget"><i class="fa fa-plus"></i> Add Target Cohort</button>
                          </div>
                          <div class="panel-body">
                              <faceted-datatable params="{ 
                                columns: options.cohortTableColumns, 
                                options: options.specificationSummaryTableOptions, 
                                pageLength: options.specificationSummaryTableOptions.pageLength,
                                lengthMenu: options.specificationSummaryTableOptions.lengthMenu,
                                dom: options.specificationSummaryTableOptions.domNoButtons,
                                reference: $component.targetCohorts,
                                rowClick: $component.removeTargetCohort
                              }"></faceted-datatable>
                          </div>
                        </div>
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            <i class="fa fa-users"></i> Outcome Cohorts
                            <button type="button" class="btn btn-primary btn-sm pull-right" data-bind="click: addOutcome"><i class="fa fa-plus"></i> Add Outcome Cohort</button>
                          </div>
                          <div class="panel-body">
                              <faceted-datatable params="{ 
                                columns: options.cohortTableColumns, 
                                options: options.specificationSummaryTableOptions, 
                                pageLength: options.specificationSummaryTableOptions.pageLength,
                                lengthMenu: options.specificationSummaryTableOptions.lengthMenu,
                                dom: options.specificationSummaryTableOptions.domNoButtons,
                                reference: $component.outcomeCohorts,
                                rowClick: $component.removeOutcomeCohort
                              }"></faceted-datatable>
                          </div>
                        </div>
                        </div>
                    </div>
                </div>
              </div>
            </div>
            <div role="tabpanel" data-bind="visible: $component.specificationPillMode() == 'all' || $component.specificationPillMode() == 'analysisSettings'" class="tab-pane">
              <div class="paddedWrapper">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                      <i class="fa fa-cogs"></i> Analysis Settings
                    </div>
                    <div class="panel-body">
                      <div class="paddedWrapper">
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            Model Settings
                            <div class="btn-group pull-right">
                              <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown" aria-expanded="true"><i class="fa fa-plus"></i> Add Model Settings <span class="caret"></span></button>
                              <ul class="dropdown-menu" data-bind="foreach:$component.modelSettings.options">
                                <li><a data-bind="text:$data.name, click:function() {$component.addModelSettings($data)}" href="#"></a></li>
                              </ul>
                            </div>
                          </div>
                          <div class="panel-body">
                            <faceted-datatable params="{ 
                              columns: options.modelSettingsTableColumns, 
                              options: options.specificationSummaryTableOptions, 
                              pageLength: options.specificationSummaryTableOptions.pageLength,
                              lengthMenu: options.specificationSummaryTableOptions.lengthMenu,
                              dom: options.specificationSummaryTableOptions.domNoButtons,
                              reference: $component.patientLevelPredictionAnalysis.modelSettings,
                              rowClick: $component.removeModelSetting,
                            }"></faceted-datatable>
                          </div>
                        </div>
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            Covariate Settings
                            <div class="btn-group pull-right">
                              <button type="button" class="btn btn-primary btn-sm pull-right" data-toggle="dropdown" aria-expanded="true"><i class="fa fa-plus"></i> Add Covariate Settings <span class="caret"></span></button>
                              <ul class="dropdown-menu">
                                  <li><a data-bind="click:function() {$component.addCovariateSettings('Default')}" href="#">Non-Temporal</a></li>
                                  <li><a data-bind="click:function() {$component.addCovariateSettings('Temporal')}" href="#">Temporal</a></li>
                              </ul>
                            </div>
                          </div>
                          <div class="panel-body">
                              <faceted-datatable params="{ 
                                columns: options.covariateSettingsTableColumns, 
                                options: options.specificationSummaryTableOptions, 
                                pageLength: options.specificationSummaryTableOptions.pageLength,
                                lengthMenu: options.specificationSummaryTableOptions.lengthMenu,
                                dom: options.specificationSummaryTableOptions.dom,
                                reference: $component.patientLevelPredictionAnalysis.covariateSettings,
                                rowClick: $component.removeCovariateSetting,
                              }"></faceted-datatable>
                              </div>
                        </div>
                        <div class="panel panel-default">
                          <div class="panel-heading">
                            Population Settings
                            <button type="button" class="btn btn-primary btn-sm pull-right" data-bind="click: addPopulationSettings"><i class="fa fa-plus"></i> Add Population Settings</button>
                          </div>
                          <div class="panel-body">
                            <faceted-datatable params="{ 
                              columns: options.populationSettingsTableColumns, 
                              options: options.specificationSummaryTableOptions, 
                              pageLength: options.specificationSummaryTableOptions.pageLength,
                              lengthMenu: options.specificationSummaryTableOptions.lengthMenu,
                              dom: options.specificationSummaryTableOptions.dom,
                              reference: $component.patientLevelPredictionAnalysis.populationSettings,
                              rowClick: $component.removePopulationSetting,
                            }"></faceted-datatable>
                          </div>
                        </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div role="tabpanel" data-bind="visible: $component.specificationPillMode() == 'all' || $component.specificationPillMode() == 'executionSettings'" class="tab-pane">
              <div class="paddedWrapper">
                  <div class="panel panel-primary">
                    <div class="panel-heading">
                      <i class="fa fa-cog"></i> Execution Settings
                    </div>
                    <div class="panel-body">
                        <execution-settings-editor params="getPlpDataArgs: $component.patientLevelPredictionAnalysis.getPlpDataArgs, runPlpArgs: $component.patientLevelPredictionAnalysis.runPlpArgs"></execution-settings-editor>
                    </div>
                  </div>
              </div>
            </div>
            <div role="tabpanel" data-bind="visible: $component.specificationPillMode() == 'all' || $component.specificationPillMode() == 'evaluationSettings'" class="tab-pane">
              <div class="paddedWrapper">
                <div class="panel panel-primary">
                  <div class="panel-heading">
                    <i class="fa fa-cog"></i> Evaluation Settings
                  </div>
                  <div class="panel-body">
                      <evaluation-settings-editor params="runPlpArgs: $component.patientLevelPredictionAnalysis.runPlpArgs"></evaluation-settings-editor>
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>
      <div role="tabpanel" data-bind="css: { active: $component.tabMode() == 'export' }" class="tab-pane">
        <div class="paddedWrapper">
          <ul class="nav nav-pills">
            <li role="presentation" data-bind="css: {active: $component.utilityPillMode() == 'download' }, click: function() {$component.utilityPillMode('download') };"><a>Download</a></li>
            <li role="presentation" data-bind="css: {active: $component.utilityPillMode() == 'import' }, click: function() {$component.utilityPillMode('import') };"><a>Import</a></li>
            <li role="presentation" data-bind="css: {active: $component.utilityPillMode() == 'export' }, click: function() {$component.utilityPillMode('export') };"><a>Export</a></li>
          </ul>
          <div role="tabpanel" data-bind="visible: $component.utilityPillMode() == 'download'" class="tab-pane">
            <div class="paddedWrapper">
              <button type="button" class="btn btn-primary btn-sm" data-bind="click: computeCartesian, enabled: !loadingDownload">Figure out analyses</button>
              <br/>
              <br/>
              <br/>
              <loading data-bind="visible:loadingDownload()" params="status: 'computing analyses'"></loading>
              <div data-bind="visible:(!loadingDownload() && $component.fullAnalysisList().length > 0)">
                <ul class="nav nav-tabs">
                  <li role="presentation" data-bind="css: { active: $component.downloadTabMode() == 'full' }, click: function() { $component.downloadTabMode('full') };"><a>Full Analysis List <span class="badge" data-bind="text: $component.fullAnalysisList().length"></span></a></li>
                  <li role="presentation" data-bind="css: { active: $component.downloadTabMode() == 'predictions' }, click: function() { $component.downloadTabMode('predictions') };"><a>Prediction Problem Settings <span class="badge" data-bind="text: $component.targetOutcomePairs().length"></span></a></li>
                  <li role="presentation" data-bind="css: { active: $component.downloadTabMode() == 'analysis' }, click: function() { $component.downloadTabMode('analysis') };"><a>Analysis Settings <span class="badge" data-bind="text: $component.modelCovarPopTuple().length"></span></a></li>
                </ul>
                <div id="downloadTabContent" class="tab-content">
                    <div role="tabpanel" data-bind="css: { active: $component.downloadTabMode() == 'full' }" class="tab-pane">
                        <faceted-datatable params="{ 
                          columns: options.fullAnalysisTableColumns, 
                          options: options.fullAnalysisTableOptions, 
                          pageLength: options.fullAnalysisTableOptions.pageLength,
                          lengthMenu: options.fullAnalysisTableOptions.lengthMenu,
                          dom: options.fullAnalysisTableOptions.dom,
                          reference: $component.fullAnalysisList
                        }"></faceted-datatable>
                    </div>
                    <div role="tabpanel" data-bind="css: { active: $component.downloadTabMode() == 'predictions' }" class="tab-pane">
                        <faceted-datatable params="{ 
                          columns: options.targetOutcomeTableColumns, 
                          options: options.specificationSummaryTableOptions, 
                          pageLength: options.specificationSummaryTableOptions.pageLength,
                          lengthMenu: options.specificationSummaryTableOptions.lengthMenu,
                          dom: options.specificationSummaryTableOptions.dom,
                          reference: $component.targetOutcomePairs
                        }"></faceted-datatable>
                    </div>
                    <div role="tabpanel" data-bind="css: { active: $component.downloadTabMode() == 'analysis' }" class="tab-pane">
                        <faceted-datatable params="{ 
                          columns: options.modelCovarPopTupleTableColumns, 
                          options: options.specificationSummaryTableOptions, 
                          pageLength: options.specificationSummaryTableOptions.pageLength,
                          lengthMenu: options.specificationSummaryTableOptions.lengthMenu,
                          dom: options.specificationSummaryTableOptions.dom,
                          reference: $component.modelCovarPopTuple
                        }"></faceted-datatable>
                    </div>
                    <button type="button" class="btn btn-primary"><i class="fa fa-download"></i> Download Study Package</button>
                </div>
              </div>
            </div>
          </div>
          <div role="tabpanel" data-bind="visible: $component.utilityPillMode() == 'import'" class="tab-pane">
            <div class="paddedWrapper">
              import
            </div>
          </div>
          <div role="tabpanel" data-bind="visible: $component.utilityPillMode() == 'export'" class="tab-pane">
            <div class="paddedWrapper">
              KO.toJSON
              <pre id="patientLevelPredictionAnalysisExport" data-bind="html: $component.patientLevelPredictionAnalysisJson(), selectOnFocus: {events: ['click']}"></pre>
              JSON.stringify <button class="btn btn-sm" data-bind="click: prepForSave">Prep for save</button> 
              <pre id="patientLevelPredictionAnalysisExportJSON" data-bind="html: $component.patientLevelPredictionAnalysisForWebAPI(), selectOnFocus: {events: ['click']}"></pre>
            </div>
        </div>
        </div>
      </div>
    </div> 
  </div>
  <div id="editors" data-bind="visible: $component.managerMode() == 'editor'">
      <div id="editor-heading" class="editor-container">
        <div class="paddedWrapper">
          <div class="panel panel-default">
              <div class="panel-heading">
                <div class="row">
                  <div data-bind="click: closeEditor" class="editor-back-icon"><i class="fa fa-chevron-left fa-lg"></i></div>
                  <div>
                    <div class="editor-heading" data-bind="text: $component.editorHeading"></div>
                    <div data-bind="text: $component.editorDescription"></div>
                  </div>
                </div>
              </div>
              <div class="panel-body" data-bind="if: $component.editorComponentName() != null">
                <div id="editorComponent" data-bind='component: {name: $component.editorComponentName(), params: $component.editorComponentParams()}'></div>
              </div>
          </div>
        </div>
      </div>
  </div>
	<div data-bind="modal: showCohortSelector" class="modal fade" tabindex="-1" role="dialog">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">Select Cohort...</div>
				<div class="paddedWrapper">
					<cohort-definition-browser params="{cohortDefinitionSelected: data => cohortSelected(data.id, data.name)}"></cohort-definition-browser>
				</div>
			</div>
		</div>
	</div>
</div>